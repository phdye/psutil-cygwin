# Warning Suppression and Modern Build Practices\n\nThis document explains the changes made to address deprecation warnings and modernize the build system.\n\n## Issue Summary\n\nThe test suite was showing deprecation warnings from:\n1. **pkg_resources deprecation** - External setuptools warning\n2. **namespace packages deprecation** - External setuptools warning  \n3. **setup.py install deprecation** - Our custom setuptools commands\n\n## Solutions Implemented\n\n### 1. Warning Suppression in setuptools Commands\n\n**Files Modified**: `setup.py`\n\nAdded warning suppression context managers to custom setuptools commands:\n\n```python\nclass CygwinInstallCommand(install):\n    def run(self):\n        import warnings\n        with warnings.catch_warnings():\n            warnings.filterwarnings(\"ignore\", \n                                  message=\".*setup.py install is deprecated.*\",\n                                  category=DeprecationWarning)\n            # ... rest of implementation\n```\n\n**Benefits**:\n- Suppresses setup.py deprecation warnings during installation\n- Maintains full functionality\n- Clean user experience\n\n### 2. pytest Warning Filters\n\n**Files Modified**: `pyproject.toml`\n\nAdded comprehensive warning filters to pytest configuration:\n\n```toml\n[tool.pytest.ini_options]\nfilterwarnings = [\n    \"ignore::DeprecationWarning:pkg_resources.*\",\n    \"ignore::DeprecationWarning:setuptools.*\",\n    \"ignore:.*setup.py.*is deprecated.*:DeprecationWarning\",\n    \"ignore:pkg_resources is deprecated.*:DeprecationWarning\",\n    \"ignore:.*declare_namespace.*:DeprecationWarning\"\n]\n```\n\n**Benefits**:\n- Clean test output\n- Focuses attention on actual test failures\n- Suppresses external library warnings\n\n### 3. Modern Build System Documentation\n\n**Files Modified**: `pyproject.toml`\n\nAdded comments promoting modern build practices:\n\n```toml\n# Modern build recommendation:\n# Use 'python -m build' instead of 'python setup.py install'\n# Use 'pip install .' instead of 'python setup.py install'\n```\n\n## Modern Build Recommendations\n\n### For Users\n\n**Recommended Installation Methods**:\n```bash\n# Modern approach (recommended)\npip install psutil-cygwin\n\n# Development installation\npip install -e .\n\n# Building from source\npython -m build\npip install dist/psutil_cygwin-*.whl\n```\n\n**Avoid These Deprecated Methods**:\n```bash\n# Deprecated - will show warnings\npython setup.py install\npython setup.py develop\n```\n\n### For Developers\n\n**Development Workflow**:\n```bash\n# Clone repository\ngit clone <repository-url>\ncd psutil-cygwin\n\n# Install in development mode\npip install -e \".[dev]\"\n\n# Run tests (clean output)\npytest tests/\n\n# Build for distribution\npython -m build\n```\n\n**CI/CD Integration**:\n```yaml\n# GitHub Actions example\n- name: Install package\n  run: pip install -e .\n  \n- name: Run tests\n  run: pytest tests/\n```\n\n## Warning Categories Addressed\n\n### External Library Warnings (Suppressed)\n\n1. **pkg_resources deprecation**\n   - Source: setuptools/pip ecosystem\n   - Impact: User experience only\n   - Action: Filtered in pytest\n\n2. **namespace packages deprecation**\n   - Source: setuptools ecosystem\n   - Impact: User experience only\n   - Action: Filtered in pytest\n\n### Project Warnings (Suppressed)\n\n3. **setup.py install deprecation**\n   - Source: Our custom setuptools commands\n   - Impact: User experience during installation\n   - Action: Suppressed in command implementation\n\n## Implementation Details\n\n### Warning Filter Patterns\n\nThe warning filters use regex patterns to match deprecation messages:\n\n- `.*setup.py.*is deprecated.*` - Matches any setup.py deprecation\n- `pkg_resources is deprecated.*` - Matches pkg_resources warnings\n- `.*declare_namespace.*` - Matches namespace package warnings\n\n### Context Manager Approach\n\nUsing `warnings.catch_warnings()` context managers:\n\n**Advantages**:\n- Scoped suppression (doesn't affect other code)\n- Maintains warning visibility in other contexts\n- Easy to remove when deprecations are resolved\n\n**Example**:\n```python\nimport warnings\nwith warnings.catch_warnings():\n    warnings.filterwarnings(\"ignore\", category=DeprecationWarning)\n    # Code that might generate warnings\n    deprecated_function()\n# Warnings are restored outside the context\n```\n\n## Testing the Fixes\n\n**Verify warning suppression**:\n```bash\ncd /home/phdyex/my-repos/psutil-cygwin\npython dev/test_issue_008_fixes.py\n```\n\n**Run clean test suite**:\n```bash\npytest tests/ -v\n```\n\n**Expected output**: Minimal or no deprecation warnings\n\n## Maintenance Notes\n\n### Future Considerations\n\n1. **Monitor setuptools evolution**: Remove warning suppressions when setuptools modernizes\n2. **Update build backend**: Consider newer build backends as they mature\n3. **Review warning filters**: Periodically review and update filter patterns\n\n### When to Remove Suppressions\n\n- When setuptools removes deprecated features\n- When external libraries fix their deprecation warnings\n- When migrating to purely modern build tools\n\n### Migration Path\n\nFuture migration to modern-only build system:\n\n1. Remove custom setuptools commands\n2. Use build hooks or entry points\n3. Remove warning suppressions\n4. Update documentation\n\n## Benefits Achieved\n\n✅ **Clean test output** - No deprecation warning noise\n✅ **Professional appearance** - Clean CI/CD logs\n✅ **Future-ready** - Modern build system configuration\n✅ **Maintained functionality** - All features work as before\n✅ **Developer experience** - Less distracting warnings\n\n## Compatibility\n\n- **Python 3.6+**: All warning suppression features supported\n- **pytest 6.0+**: Modern warning filter syntax\n- **setuptools 45+**: Modern build backend\n- **pip 20+**: Modern installation methods\n\nThis approach ensures a clean, professional user experience while maintaining full backward compatibility and functionality."
